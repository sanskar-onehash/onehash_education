<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ title or 'Assessment' }}</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    {{ include_style('website.bundle.css') }}
    <link rel="stylesheet" href="./assessment.css" />
    {% if custom_style %}
    <style>
      {{ custom_style }}
    </style>
    {% endif %}

    <script>
      window.frappe = {};
      frappe.ready_events = [];
      frappe.ready = function(fn) {
      	frappe.ready_events.push(fn);
      }
      window.dev_server = {{ dev_server }};
      window.socketio_port = {{ (frappe.socketio_port or 9000) }};
      window.show_language_picker = {{ show_language_picker or 'false' }};
    </script>
  </head>
  <body>
    <div class="assessment-bg"></div>
    <div class="assessment-container">
      <div class="assessment-card">
        <header class="assessment-header">
          <h1>{{ title or 'Assessment' }}</h1>
          {% if error %}
          <div class="assessment-error">{{ error }}</div>
          {% endif %}
        </header>
        {% if not error and not submitted %}
        <form
          id="assessmentForm"
          class="assessment-form"
          method="post"
          autocomplete="off"
          data-assessment-id="{{ assessment_id }}"
        >
          <ol class="assessment-questions">
            {% set ns = namespace(q_counter=0) %} {% for group in
            grouped_questions %}
            <div class="question-group" data-group-index="{{ loop.index0 }}">
              {% if group.heading %}
              <div class="question-heading">{{ group.heading|safe }}</div>
              {% endif %} {% for q in group.questions %}
              <li
                class="question-block"
                data-question-index="{{ ns.q_counter }}"
              >
                <div class="question-text">
                  <span class="q-index">Q{{ ns.q_counter + 1 }}.</span>
                  {{ q.question }}
                </div>
                <div class="question-input">
                  {% if q.question_type == 'Integer' %}
                  <input
                    type="number"
                    class="input-field"
                    step="1"
                    name="{{ q.question_id }}"
                    required
                  />
                  {% elif q.question_type == 'Float' %}
                  <input
                    type="number"
                    class="input-field"
                    step="any"
                    name="{{ q.question_id }}"
                    required
                  />
                  {% elif q.question_type == 'Boolean' %}
                  <div class="boolean-group">
                    <label>
                      <input
                        type="radio"
                        value="True"
                        name="{{ q.question_id }}"
                        required
                      />
                      True
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="{{ q.question_id }}"
                        value="False"
                      />
                      False
                    </label>
                  </div>
                  {% elif q.question_type == 'Date' %}
                  <input
                    type="date"
                    class="input-field"
                    name="{{ q.question_id }}"
                    required
                  />
                  {% elif q.question_type == 'Single Choice' %}
                  <div class="choice-group">
                    {% for opt in q.options %}
                    <label class="choice-label">
                      <input
                        type="radio"
                        value="{{ opt }}"
                        name="{{ q.question_id }}"
                        required
                      />
                      <span class="custom-radio"></span>
                      {{ opt }}
                    </label>
                    {% endfor %}
                  </div>
                  {% elif q.question_type == 'Multiple Choice' %}
                  <div
                    class="multi-choice-group"
                    data-max="{{ q.options|length }}"
                  >
                    {% for opt in q.options %}
                    <label class="choice-label">
                      <input
                        type="checkbox"
                        name="{{ q.question_id }}"
                        value="{{ opt }}"
                      />
                      <span class="custom-checkbox"></span>
                      {{ opt }}
                    </label>
                    {% endfor %}
                  </div>
                  {% elif q.question_type == 'One Word' %}
                  <input
                    type="text"
                    class="input-field"
                    maxlength="50"
                    name="{{ q.question_id }}"
                    required
                  />
                  {% elif q.question_type == 'One Line' %}
                  <input
                    type="text"
                    class="input-field"
                    maxlength="120"
                    name="{{ q.question_id }}"
                    required
                  />
                  {% elif q.question_type == 'Short Answer' %}
                  <textarea
                    class="input-field"
                    rows="2"
                    maxlength="300"
                    name="{{ q.question_id }}"
                    required
                  ></textarea>
                  {% elif q.question_type == 'Long Answer' %}
                  <textarea
                    class="input-field"
                    rows="5"
                    maxlength="2000"
                    name="{{ q.question_id }}"
                    required
                  ></textarea>
                  {% endif %}
                </div>
              </li>
              {% set ns.q_counter = ns.q_counter + 1 %} {% endfor %}
            </div>
            {% endfor %}
          </ol>
          <div class="pagination-controls">
            <button type="button" id="prev-page-btn" aria-label="Previous Page">
              Prev
            </button>
            <span id="page-info"></span>
            <button type="button" id="next-page-btn" aria-label="Next Page">
              Next
            </button>
          </div>
          <div class="form-actions">
            <button type="submit" class="submit-btn" id="submit-btn" disabled>
              <span>Submit</span>
            </button>
          </div>
        </form>
        {% endif %} {% if not error %}
        <div
          class="form-success {{ 'hide' if not submitted else '' }}"
          id="success-msg"
        >
          <h2>Assessment Submitted</h2>
          <p>Thank you! Your answers have been successfully submitted.</p>
        </div>
        {% endif %}
      </div>
    </div>

    <script>
      frappe.boot = {{ boot | json }};
      frappe.csrf_token = "{{ csrf_token }}";
         // for backward compatibility of some libs
      frappe.sys_defaults = frappe.boot.sysdefaults;
    </script>
    {{ include_script('frappe-web.bundle.js') }}
    <script src="./assessment.js"></script>
    {% if custom_script %}
    <script>
      {
        {
          custom_script;
        }
      }
    </script>
    {% endif %}
  </body>
</html>
